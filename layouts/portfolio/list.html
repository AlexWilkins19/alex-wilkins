{{ define "main" }}
<div class="grid-wrapper">

  <!-- Intro section (unchanged) -->
  <div class="introwords" style="max-width: 1200px; margin: 0 auto;">
    {{ $numArticles := len .Site.Data.articles.articles }}
    <div style="margin-left: 15vw;">
      <p class="words">
        I've worked as a reporter for New Scientist since 2021. In that time, I've written {{ $numArticles }} articles.
        My most recent articles are in the grid below. A few highlights are above them.
      </p>
    </div>
  </div>

  <!-- HIGHLIGHTS SECTION (unchanged) -->
  <h2 class="SectionHeading">Highlights</h2>
  <hr class="hrline">
  <div class="grid-container highlights">
    <div class="grid-item">
      <a class="CardLink" href="https://www.newscientist.com/article/mg25634080-400-human-hibernation-is-a-real-possibility-this-is-how-it-might-work/" target="_blank" rel="noopener noreferrer">
        <article class="Card">
          <div class="Card__Content">
            <div class="Card__ImageWrapper grid-image-wrapper">
              <img src="https://images.newscientist.com/wp-content/uploads/2022/10/07134137/SEI_128464282.jpg?width=900"
                   alt="Human hibernation is a real possibility - this is how it might work"
                   width="1350" height="900" />
            </div>
            <div class="Card__CopyWrapper">
              <h3 class="Card__Title">Human hibernation is a real possibility - this is how it might work</h3>
            </div>
          </div>
        </article>
      </a>
    </div>
    <div class="grid-item">
      <a class="CardLink" href="https://www.newscientist.com/article/2315418-particle-physics-could-be-rewritten-after-shock-w-boson-measurement/" target="_blank">
        <article class="Card">
          <div class="Card__Content">
            <div class="Card__ImageWrapper grid-image-wrapper">
              <img src="https://images.newscientist.com/wp-content/uploads/2022/04/07143511/SEI_97419882.jpg?width=900"
                   alt="Particle physics could be rewritten after shock W boson measurement"
                   width="1350" height="900" />
            </div>
            <div class="Card__CopyWrapper">
              <h3 class="Card__Title">Particle physics could be rewritten after shock W boson measurement</h3>
            </div>
          </div>
        </article>
      </a>
    </div>
    <div class="grid-item">
      <a class="CardLink" href="https://www.newscientist.com/article/2346939-how-will-ais-that-generate-videos-from-text-transform-media-online/" target="_blank">
        <article class="Card">
          <div class="Card__Content">
            <div class="Card__ImageWrapper grid-image-wrapper">
              <img src="https://images.newscientist.com/wp-content/uploads/2022/11/15121652/SEI_133201072.jpg?width=900"
                   alt="How will AIs that generate videos from text transform media online?"
                   width="1350" height="900" />
            </div>
            <div class="Card__CopyWrapper">
              <h3 class="Card__Title">How will AIs that generate videos from text transform media online?</h3>
            </div>
          </div>
        </article>
      </a>
    </div>
  </div>

  <!-- NEW SCIENTIST SECTION -->
  <h2 class="SectionHeading" id="newscientisttop">New Scientist</h2>
  <hr class="hrline">

  <!-- 1) Output *all* articles in one container -->
  <div id="article-grid" class="grid-container new scientist">
    {{ range .Site.Data.articles.articles }}
      <div class="grid-item article">
        <a class="CardLink" href="{{ .url }}" target="_blank" rel="noopener">
          <article class="Card">
            <div class="Card__Content">
              <div class="Card__ImageWrapper grid-image-wrapper">
                <img src="{{ .imageUrl }}"
                     alt="{{ .title }}"
                     width="1350" height="900" />
              </div>
              <div class="Card__CopyWrapper">
                <h3 class="Card__Title">{{ .title }}</h3>
              </div>
            </div>
          </article>
        </a>
      </div>
    {{ end }}
  </div>

  <!-- 2) The pagination controls (Previous/Next) -->
  <div id="pagination-controls" style="text-align:center; margin: 2rem 0;">
    <button id="prev-btn" class="prev-link" style="margin-right: 1rem;">Previous</button>
    <span id="page-info"></span>
    <button id="next-btn" class="next-link" style="margin-left: 1rem;">Next</button>
  </div>

</div>

<!-- 3) Scroll-to-grid script partial (unchanged) -->
{{ partial "scroll-to-grid.js" . }}

<!-- 4) Client-Side Pagination Script -->
<script>
(function() {
  // The number of articles we show per page
  const pageSize = 9;

  // Current page starts at 1
  let currentPage = 1;

  // Get ALL article elements
  const articles = document.querySelectorAll('#article-grid .article');
  const totalArticles = articles.length;
  const totalPages = Math.ceil(totalArticles / pageSize);

  // DOM elements
  const prevBtn = document.getElementById('prev-btn');
  const nextBtn = document.getElementById('next-btn');
  const pageInfo = document.getElementById('page-info');

  // This function shows only the slice of articles for the given page
  function showPage(page) {
    // Hide all articles
    articles.forEach(a => (a.style.display = 'none'));

    // Calculate start & end indexes
    const start = (page - 1) * pageSize;
    const end = start + pageSize;

    // Show the subset for this page
    for (let i = start; i < end && i < totalArticles; i++) {
      articles[i].style.display = 'block';
    }

    // Update "Page X of Y" text
    pageInfo.textContent = `Page ${page} of ${totalPages}`;

    // Disable/enable buttons as needed
    prevBtn.disabled = (page <= 1);
    nextBtn.disabled = (page >= totalPages);
  }

  // Event listeners for the buttons
  prevBtn.addEventListener('click', () => {
    if (currentPage > 1) {
      currentPage--;
      showPage(currentPage);
    }
  });

  nextBtn.addEventListener('click', () => {
    if (currentPage < totalPages) {
      currentPage++;
      showPage(currentPage);
    }
  });

  // Show page 1 initially
  showPage(currentPage);
})();
</script>
{{ end }}
